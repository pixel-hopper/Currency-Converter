<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Currency Converter</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üí±</text></svg>">
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500&display=swap" rel="stylesheet" />
  <style>
    :root {
      --color-bg-light: #f1f3f4;
      --color-bg-dark: #121212;
      --color-primary: #4285f4;
      --color-text-light: #202124;
      --color-text-dark: #e8eaed;
      --color-bubble-light: #ffffff;
      --color-bubble-dark: #1e1e1e;
    }

    @media (prefers-color-scheme: dark) {
      body {
        background-color: var(--color-bg-dark);
        color: var(--color-text-dark);
      }
      input, select {
        background-color: #2c2c2c;
        color: #e8eaed;
        border: 1px solid #5f6368;
      }
      .bubble {
        background-color: var(--color-bubble-dark);
      }
    }

    @media (prefers-color-scheme: light) {
      body {
        background-color: var(--color-bg-light);
        color: var(--color-text-light);
      }
      input, select {
        background-color: #ffffff;
        color: #202124;
        border: 1px solid #dadce0;
      }
      .bubble {
        background-color: var(--color-bubble-light);
      }
    }

    body {
      font-family: 'Roboto', sans-serif;
      margin: 0;
      padding: 2rem;
      transition: background 0.3s ease, color 0.3s ease;
    }

    h2 {
      text-align: center;
      font-weight: 500;
      color: inherit;
      margin-bottom: 2rem;
      font-size: 2rem;
    }

    .container {
      max-width: 800px;
      margin: 0 auto;
    }

    .bubble {
      border-radius: 1rem;
      padding: 1.5rem;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
      margin-bottom: 2rem;
      transition: background 0.3s ease;
    }

    .input-container {
      display: flex;
      gap: 1rem;
      margin-bottom: 1rem;
      max-width: 800px;
      margin-left: auto;
      margin-right: auto;
    }
    
    .search-container {
      max-width: 800px;
      margin: 0 auto 2rem auto;
    }
    
    .search-group {
      width: 100%;
    }
    
    #currency-search {
      width: 100%;
      padding: 0.75rem 1rem;
      border-radius: 8px;
      font-size: 1rem;
      box-sizing: border-box;
    }

    .input-group {
      display: flex;
      flex-direction: column;
      flex: 1;
    }

    .input-group label {
      margin-bottom: 0.5rem;
      font-size: 0.9rem;
      color: inherit;
      opacity: 0.8;
    }

    input[type="number"] {
      padding: 0.75rem 1rem;
      border-radius: 8px;
      font-size: 1rem;
      width: 100%;
      box-sizing: border-box;
    }

    select {
      padding: 0.75rem 1rem;
      border-radius: 8px;
      font-size: 1rem;
      cursor: pointer;
      min-width: 120px;
    }

    .results {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 1rem;
      margin-top: 1.5rem;
    }

    .result-item {
      background-color: rgba(66, 133, 244, 0.1);
      padding: 1rem;
      border-radius: 8px;
      text-align: center;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }
    
    .result-item:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }

    .result-value {
      font-size: 1.5rem;
      font-weight: 500;
      margin: 0.5rem 0;
      color: var(--color-primary);
    }

    .result-label {
      font-size: 0.9rem;
      opacity: 0.9;
      margin-bottom: 0.25rem;
    }
    
    .exchange-rate {
      font-size: 0.75rem;
      opacity: 0.7;
      margin-top: 0.25rem;
    }
    
    .no-results {
      grid-column: 1 / -1;
      text-align: center;
      padding: 2rem;
      opacity: 0.8;
    }
    
    .disclaimer {
      text-align: center;
      margin: 1rem 0;
      padding: 0.75rem;
      background-color: var(--color-bubble);
      border-radius: 8px;
      font-size: 0.9rem;
      color: var(--color-text-secondary);
    }
    
    .update-container {
      display: flex;
      justify-content: center;
      margin: 1rem auto;
      max-width: 800px;
      padding: 0 1rem;
    }

    .update-bubble {
      display: flex;
      align-items: center;
      gap: 1.5rem;
      background-color: var(--color-bubble);
      padding: 0.75rem 1.5rem;
      border-radius: 25px;
      font-size: 0.95rem;
      color: var(--color-text);
      transition: all 0.2s ease;
    }
    
    .update-bubble:hover {
      transform: translateY(-2px);
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }
    
    .update-item {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    
    .update-separator {
      color: var(--color-text-light);
      opacity: 0.5;
    }
    
    .refresh-button {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      background: none;
      border: none;
      color: var(--color-primary);
      cursor: pointer;
      padding: 0.4rem 0.8rem;
      border-radius: 15px;
      transition: all 0.2s ease;
    }
    
    .refresh-button:hover {
      background-color: rgba(255, 255, 255, 0.1);
    }
    
    #last-update, #countdown {
      font-weight: 600;
      color: var(--color-primary);
      background-color: rgba(255, 255, 255, 0.1);
      padding: 0.2rem 0.6rem;
      border-radius: 12px;
    }
    #countdown {
      font-weight: bold;
      color: var(--color-primary);
      min-width: 20px;
      display: inline-block;
    }
    
    .refresh-button {
      background: none;
      border: 1px solid var(--color-primary);
      color: var(--color-primary);
      border-radius: 4px;
      padding: 0.25rem 0.75rem;
      font-size: 0.8rem;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      transition: all 0.2s ease;
      margin-left: 0.5rem;
    }
    
    .refresh-button:hover {
      background: rgba(66, 133, 244, 0.1);
    }
    
    .refresh-button svg {
      animation: spin 1s linear infinite;
      display: none;
    }
    
    .refresh-button.loading svg {
      display: block;
    }
    
    .refresh-button.loading span {
      display: none;
    }
    
    @keyframes spin {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }
    
    @media (prefers-color-scheme: dark) {
      .disclaimer {
        color: var(--color-text-dark);
      }
    }

    @media (max-width: 600px) {
      .input-container {
        flex-direction: column;
      }
      
      .results {
        grid-template-columns: 1fr 1fr;
      }
    }
  </style>
</head>
<body>
  <h2>üí± Currency Converter</h2>
  
  <div class="update-container">
    <div class="update-bubble">
      <div class="update-item">
        <span>Last update: </span>
        <span id="last-update">Just now</span>
      </div>
      <div class="update-separator">‚Ä¢</div>
      <div class="update-item">
        <span>Next update: </span>
        <span id="countdown">24h 00m 00s</span>
      </div>
      <button id="refresh-now" class="refresh-button">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M21.5 2v6h-6M2.5 22v-6h6M22 12a10 10 0 0 0-17.07-7.07M2 12a10 10 0 0 0 17.07 7.07"></path>
        </svg>
        Refresh
      </button>
    </div>
  </div>
  <div class="disclaimer">
    <p>Exchange rates are sourced from the European Central Bank (ECB) and updated once daily.</p>
  </div>

  <div class="container">
    <div class="bubble">
          <div class="input-container">
        <div class="input-group">
          <label for="amount">Amount</label>
          <input type="number" id="amount" placeholder="Enter amount" value="1" min="0" step="0.01" />
        </div>
        <div class="input-group">
          <label for="from-currency">From</label>
          <select id="from-currency">
            <option value="EUR">Euro (EUR)</option>
            <option value="USD">US Dollar (USD)</option>
            <option value="GBP">British Pound (GBP)</option>
            <option value="JPY">Japanese Yen (JPY)</option>
            <option value="AUD">Australian Dollar (AUD)</option>
            <option value="CAD">Canadian Dollar (CAD)</option>
            <option value="CHF">Swiss Franc (CHF)</option>
            <option value="CNY">Chinese Yuan (CNY)</option>
            <option value="INR">Indian Rupee (INR)</option>
            <option value="NZD">New Zealand Dollar (NZD)</option>
            <option value="MXN">Mexican Peso (MXN)</option>
            <option value="BRL">Brazilian Real (BRL)</option>
            <option value="ZAR">South African Rand (ZAR)</option>
            <option value="RUB">Russian Ruble (RUB)</option>
            <option value="KRW">South Korean Won (KRW)</option>
            <option value="SGD">Singapore Dollar (SGD)</option>
            <option value="NOK">Norwegian Krone (NOK)</option>
            <option value="SEK">Swedish Krona (SEK)</option>
            <option value="DKK">Danish Krone (DKK)</option>
            <option value="PLN">Polish Z≈Çoty (PLN)</option>
            <option value="THB">Thai Baht (THB)</option>
            <option value="IDR">Indonesian Rupiah (IDR)</option>
            <option value="HKD">Hong Kong Dollar (HKD)</option>
            <option value="TRY">Turkish Lira (TRY)</option>
            <option value="SAR">Saudi Riyal (SAR)</option>
            <option value="AED">UAE Dirham (AED)</option>
            <option value="MYR">Malaysian Ringgit (MYR)</option>
            <option value="PHP">Philippine Peso (PHP)</option>
            <option value="VND">Vietnamese ƒê·ªìng (VND)</option>
            <option value="EGP">Egyptian Pound (EGP)</option>
            <option value="PKR">Pakistani Rupee (PKR)</option>
            <option value="NGN">Nigerian Naira (NGN)</option>
            <option value="BDT">Bangladeshi Taka (BDT)</option>
            <option value="IRR">Iranian Rial (IRR)</option>
            <option value="IQD">Iraqi Dinar (IQD)</option>
            <option value="KWD">Kuwaiti Dinar (KWD)</option>
            <option value="QAR">Qatari Riyal (QAR)</option>
            <option value="OMR">Omani Rial (OMR)</option>
            <option value="JOD">Jordanian Dinar (JOD)</option>
            <option value="LBP">Lebanese Pound (LBP)</option>
            <option value="BHD">Bahraini Dinar (BHD)</option>
            <option value="COP">Colombian Peso (COP)</option>
            <option value="ARS">Argentine Peso (ARS)</option>
            <option value="CLP">Chilean Peso (CLP)</option>
            <option value="PEN">Peruvian Sol (PEN)</option>
            <option value="UYU">Uruguayan Peso (UYU)</option>
            <option value="BOB">Bolivian Boliviano (BOB)</option>
            <option value="PYG">Paraguayan Guaran√≠ (PYG)</option>
            <option value="DOP">Dominican Peso (DOP)</option>
            <option value="GTQ">Guatemalan Quetzal (GTQ)</option>
            <option value="HNL">Honduran Lempira (HNL)</option>
            <option value="NIO">Nicaraguan C√≥rdoba (NIO)</option>
            <option value="SVC">Salvorean Col√≥n (SVC)</option>
            <option value="PAB">Panamanian Balboa (PAB)</option>
            <option value="CRC">Costa Rican Col√≥n (CRC)</option>
            <option value="CUC">Cuban Convertible Peso (CUC)</option>
            <option value="CUP">Cuban Peso (CUP)</option>
            <option value="JMD">Jamaican Dollar (JMD)</option>
            <option value="TTD">Trinidad & Tobago Dollar (TTD)</option>
            <option value="BBD">Barbadian Dollar (BBD)</option>
            <option value="XCD">East Caribbean Dollar (XCD)</option>
            <option value="BZD">Belize Dollar (BZD)</option>
            <option value="BMD">Bermudian Dollar (BMD)</option>
            <option value="BSD">Bahamian Dollar (BSD)</option>
          </select>
        </div>
      </div>
      
      <div class="search-container">
        <div class="input-group search-group">
          <label for="currency-search">Search Currency</label>
          <input type="text" id="currency-search" placeholder="Type to search currencies..." />
        </div>
      </div>

      <div class="results" id="conversion-results">
        <!-- Results will be populated by JavaScript -->
      </div>
    </div>
  </div>

  <script>
    // Exchange rates (as of the last update - these are approximate and should be updated with real-time data in production)
    const exchangeRates = {
      USD: 1,         // US Dollar (base currency)
      EUR: 0.92,      // Euro
      GBP: 0.79,      // British Pound
      JPY: 156.25,    // Japanese Yen
      AUD: 1.52,      // Australian Dollar
      CAD: 1.37,      // Canadian Dollar
      CHF: 0.90,      // Swiss Franc
      CNY: 7.24,      // Chinese Yuan
      INR: 83.45,     // Indian Rupee
      NZD: 1.66,      // New Zealand Dollar
      MXN: 17.25,     // Mexican Peso
      BRL: 5.15,      // Brazilian Real
      ZAR: 18.75,     // South African Rand
      RUB: 92.50,     // Russian Ruble
      KRW: 1350.25,   // South Korean Won
      SGD: 1.35,      // Singapore Dollar
      NOK: 10.75,     // Norwegian Krone
      SEK: 10.60,     // Swedish Krona
      DKK: 6.90,      // Danish Krone
      PLN: 4.15,      // Polish Z≈Çoty
      THB: 36.50,     // Thai Baht
      IDR: 16250.00,  // Indonesian Rupiah
      HKD: 7.82,      // Hong Kong Dollar
      TRY: 32.10,     // Turkish Lira
      SAR: 3.75,      // Saudi Riyal
      AED: 3.67,      // UAE Dirham
      MYR: 4.75,      // Malaysian Ringgit
      PHP: 56.80,     // Philippine Peso
      VND: 25400.00,  // Vietnamese ƒê·ªìng
      EGP: 47.25,     // Egyptian Pound
      PKR: 278.50,    // Pakistani Rupee
      NGN: 1150.00,   // Nigerian Naira
      BDT: 117.50,    // Bangladeshi Taka
      IRR: 42000.00,  // Iranian Rial
      IQD: 1310.00,   // Iraqi Dinar
      KWD: 0.31,      // Kuwaiti Dinar
      QAR: 3.64,      // Qatari Riyal
      OMR: 0.38,      // Omani Rial
      JOD: 0.71,      // Jordanian Dinar
      LBP: 15000.00,  // Lebanese Pound
      BHD: 0.38,      // Bahraini Dinar
      COP: 3950.00,   // Colombian Peso
      ARS: 850.00,    // Argentine Peso
      CLP: 920.00,    // Chilean Peso
      PEN: 3.80,      // Peruvian Sol
      UYU: 39.20,     // Uruguayan Peso
      BOB: 6.92,      // Bolivian Boliviano
      PYG: 7350.00,   // Paraguayan Guaran√≠
      DOP: 58.75,     // Dominican Peso
      GTQ: 7.82,      // Guatemalan Quetzal
      HNL: 24.75,     // Honduran Lempira
      NIO: 36.75,     // Nicaraguan C√≥rdoba
      SVC: 8.75,      // Salvadoran Col√≥n
      PAB: 1.00,      // Panamanian Balboa (1:1 with USD)
      CRC: 535.00,    // Costa Rican Col√≥n
      CUC: 1.00,      // Cuban Convertible Peso (1:1 with USD)
      CUP: 24.00,     // Cuban Peso
      JMD: 155.50,    // Jamaican Dollar
      TTD: 6.78,      // Trinidad & Tobago Dollar
      BBD: 2.00,      // Barbadian Dollar (2:1 with USD)
      XCD: 2.70,      // East Caribbean Dollar
      BZD: 2.00,      // Belize Dollar (2:1 with USD)
      BMD: 1.00,      // Bermudian Dollar (1:1 with USD)
      BSD: 1.00       // Bahamian Dollar (1:1 with USD)
    };

    const currencies = [
      { code: 'USD', name: 'US Dollar' },
      { code: 'EUR', name: 'Euro' },
      { code: 'GBP', name: 'British Pound' },
      { code: 'JPY', name: 'Japanese Yen' },
      { code: 'AUD', name: 'Australian Dollar' },
      { code: 'CAD', name: 'Canadian Dollar' },
      { code: 'CHF', name: 'Swiss Franc' },
      { code: 'CNY', name: 'Chinese Yuan' },
      { code: 'INR', name: 'Indian Rupee' },
      { code: 'NZD', name: 'New Zealand Dollar' },
      { code: 'MXN', name: 'Mexican Peso' },
      { code: 'BRL', name: 'Brazilian Real' },
      { code: 'ZAR', name: 'South African Rand' },
      { code: 'RUB', name: 'Russian Ruble' },
      { code: 'KRW', name: 'South Korean Won' },
      { code: 'SGD', name: 'Singapore Dollar' },
      { code: 'NOK', name: 'Norwegian Krone' },
      { code: 'SEK', name: 'Swedish Krona' },
      { code: 'DKK', name: 'Danish Krone' },
      { code: 'PLN', name: 'Polish Z≈Çoty' },
      { code: 'THB', name: 'Thai Baht' },
      { code: 'IDR', name: 'Indonesian Rupiah' },
      { code: 'HKD', name: 'Hong Kong Dollar' },
      { code: 'TRY', name: 'Turkish Lira' },
      { code: 'SAR', name: 'Saudi Riyal' },
      { code: 'AED', name: 'UAE Dirham' },
      { code: 'MYR', name: 'Malaysian Ringgit' },
      { code: 'PHP', name: 'Philippine Peso' },
      { code: 'VND', name: 'Vietnamese ƒê·ªìng' },
      { code: 'EGP', name: 'Egyptian Pound' },
      { code: 'PKR', name: 'Pakistani Rupee' },
      { code: 'NGN', name: 'Nigerian Naira' },
      { code: 'BDT', name: 'Bangladeshi Taka' },
      { code: 'IRR', name: 'Iranian Rial' },
      { code: 'IQD', name: 'Iraqi Dinar' },
      { code: 'KWD', name: 'Kuwaiti Dinar' },
      { code: 'QAR', name: 'Qatari Riyal' },
      { code: 'OMR', name: 'Omani Rial' },
      { code: 'JOD', name: 'Jordanian Dinar' },
      { code: 'LBP', name: 'Lebanese Pound' },
      { code: 'BHD', name: 'Bahraini Dinar' },
      { code: 'COP', name: 'Colombian Peso' },
      { code: 'ARS', name: 'Argentine Peso' },
      { code: 'CLP', name: 'Chilean Peso' },
      { code: 'PEN', name: 'Peruvian Sol' },
      { code: 'UYU', name: 'Uruguayan Peso' },
      { code: 'BOB', name: 'Bolivian Boliviano' },
      { code: 'PYG', name: 'Paraguayan Guaran√≠' },
      { code: 'DOP', name: 'Dominican Peso' },
      { code: 'GTQ', name: 'Guatemalan Quetzal' },
      { code: 'HNL', name: 'Honduran Lempira' },
      { code: 'NIO', name: 'Nicaraguan C√≥rdoba' },
      { code: 'SVC', name: 'Salvorean Col√≥n' },
      { code: 'PAB', name: 'Panamanian Balboa' },
      { code: 'CRC', name: 'Costa Rican Col√≥n' },
      { code: 'CUC', name: 'Cuban Convertible Peso' },
      { code: 'CUP', name: 'Cuban Peso' },
      { code: 'JMD', name: 'Jamaican Dollar' },
      { code: 'TTD', name: 'Trinidad & Tobago Dollar' },
      { code: 'BBD', name: 'Barbadian Dollar' },
      { code: 'XCD', name: 'East Caribbean Dollar' },
      { code: 'BZD', name: 'Belize Dollar' },
      { code: 'BMD', name: 'Bermudian Dollar' },
      { code: 'BSD', name: 'Bahamian Dollar' }
    ];
    
    // Store filtered currencies for search functionality
    let filteredCurrencies = [...currencies];
    
    // Countdown timer variables
    let countdownInterval;
    
    // Function to get the next ECB update time (4 PM CET on next business day)
    function getNextECBUpdateTime() {
      const now = new Date();
      const cetOffset = 2 * 60 * 60 * 1000; // CEST (UTC+2) in milliseconds
      const cetTime = new Date(now.getTime() + (now.getTimezoneOffset() * 60 * 1000) + cetOffset);
      
      // Set target time to 4 PM CET
      const target = new Date(cetTime);
      target.setHours(16, 0, 0, 0); // 4 PM
      
      // If it's already past 4 PM CET today, set to next business day
      if (cetTime >= target) {
        target.setDate(target.getDate() + 1);
        
        // Skip weekends (0 = Sunday, 6 = Saturday)
        if (target.getDay() === 0) target.setDate(target.getDate() + 1);
        if (target.getDay() === 6) target.setDate(target.getDate() + 2);
      }
      
      // Skip weekends if we landed on one
      if (target.getDay() === 0) target.setDate(target.getDate() + 1);
      if (target.getDay() === 6) target.setDate(target.getDate() + 2);
      
      return target;
    }
    
    // Function to format time remaining as HH:MM:SS
    function formatTimeRemaining(milliseconds) {
      const totalSeconds = Math.floor(milliseconds / 1000);
      const hours = Math.floor(totalSeconds / 3600);
      const minutes = Math.floor((totalSeconds % 3600) / 60);
      const seconds = totalSeconds % 60;
      
      return `${hours.toString().padStart(2, '0')}h ${minutes.toString().padStart(2, '0')}m ${seconds.toString().padStart(2, '0')}s`;
    }
    
    // Function to update the countdown display
    function updateCountdown() {
      const countdownElement = document.getElementById('countdown');
      if (!countdownElement) return;
      
      const now = new Date();
      const nextUpdate = getNextECBUpdateTime();
      const timeRemaining = nextUpdate - now;
      
      if (timeRemaining <= 0) {
        // Time's up, refresh the rates
        refreshRates();
        return;
      }
      
      // Update the countdown display
      countdownElement.textContent = formatTimeRemaining(timeRemaining);
    }
    
    // Function to start the countdown
    function startCountdown() {
      clearInterval(countdownInterval);
      updateCountdown(); // Update immediately
      
      // Update every second
      countdownInterval = setInterval(updateCountdown, 1000);
    }
    
    // Function to parse ECB XML data
    function parseECBData(xmlText) {
      const parser = new DOMParser();
      const xmlDoc = parser.parseFromString(xmlText, 'text/xml');
      const cubes = xmlDoc.getElementsByTagName('Cube');
      const rates = { 'EUR': 1 }; // Base currency is EUR
      
      // Find the most recent rate set (last Cube with currency attributes)
      for (let i = cubes.length - 1; i >= 0; i--) {
        const cube = cubes[i];
        if (cube.hasAttribute('currency')) {
          const currency = cube.getAttribute('currency');
          const rate = parseFloat(cube.getAttribute('rate'));
          if (currency && !isNaN(rate)) {
            rates[currency] = rate;
          }
        }
      }
      
      // Convert all rates to USD base (since ECB uses EUR as base)
      const usdToEur = 1 / rates['USD'];
      const usdRates = { 'USD': 1 };
      
      for (const [currency, rate] of Object.entries(rates)) {
        if (currency !== 'USD') {
          usdRates[currency] = rate * usdToEur;
        }
      }
      
      return usdRates;
    }
    
    // Function to fetch exchange rates from European Central Bank
    async function fetchNewRates() {
      try {
        const response = await fetch('https://www.ecb.europa.eu/stats/eurofxref/eurofxref-daily.xml');
        const xmlText = await response.text();
        
        // Parse the XML response
        const newRates = parseECBData(xmlText);
        
        // Add any missing currencies that weren't in the ECB data
        // (using the existing rates as fallback)
        for (const [currency, rate] of Object.entries(exchangeRates)) {
          if (!(currency in newRates) && currency !== 'USD') {
            newRates[currency] = rate;
          }
        }
        
        return newRates;
      } catch (error) {
        console.error('Error fetching ECB rates:', error);
        // Return current rates as fallback if there's an error
        return exchangeRates;
      }
    }
    
    // Function to refresh exchange rates
    async function refreshRates() {
      const refreshButton = document.getElementById('refresh-now');
      const lastUpdateElement = document.getElementById('last-update');
      refreshButton.classList.add('loading');
      
      try {
        const newRates = await fetchNewRates();
        
        // Update the exchange rates
        Object.assign(exchangeRates, newRates);
        
        // Update the last updated timestamp
        const now = new Date();
        lastUpdateElement.textContent = now.toLocaleString();
        
        // Restart the countdown
        startCountdown();
        
        // Update the display with new rates
        convertCurrency();
      } catch (error) {
        console.error('Error refreshing rates:', error);
        lastUpdateElement.textContent = 'Error fetching latest rates';
        // Even if there's an error, restart the countdown
        startCountdown();
      } finally {
        refreshButton.classList.remove('loading');
      }
    }

    function convertCurrency() {
      const amount = parseFloat(document.getElementById('amount').value) || 0;
      const fromCurrency = document.getElementById('from-currency').value;
      const searchTerm = document.getElementById('currency-search').value.toLowerCase();
      
      // Get the base rate (USD)
      const baseAmount = amount / exchangeRates[fromCurrency];
      
      const resultsContainer = document.getElementById('conversion-results');
      resultsContainer.innerHTML = '';
      
      // Use filtered currencies if there's a search term, otherwise use all currencies
      const currenciesToDisplay = searchTerm ? filteredCurrencies : currencies;
      
      if (currenciesToDisplay.length === 0) {
        resultsContainer.innerHTML = '<div class="no-results">No currencies found matching your search.</div>';
        return;
      }
      
      currenciesToDisplay.forEach(currency => {
        if (currency.code !== fromCurrency) {
          const rate = exchangeRates[currency.code] / exchangeRates[fromCurrency];
          const convertedAmount = (amount * rate).toFixed(4);
          
          const resultItem = document.createElement('div');
          resultItem.className = 'result-item';
          resultItem.innerHTML = `
            <div class="result-value">${convertedAmount}</div>
            <div class="result-label">${currency.name} (${currency.code})</div>
            <div class="exchange-rate">1 ${fromCurrency} = ${rate.toFixed(6)} ${currency.code}</div>
          `;
          
          resultsContainer.appendChild(resultItem);
        }
      });
    }

    // Filter and display currencies based on search
    function filterCurrencies(searchTerm) {
      if (!searchTerm) {
        filteredCurrencies = [...currencies];
      } else {
        const term = searchTerm.toLowerCase();
        filteredCurrencies = currencies.filter(currency => 
          currency.name.toLowerCase().includes(term) || 
          currency.code.toLowerCase().includes(term)
        );
      }
      convertCurrency();
    }
    
    // Initialize the currency dropdown
    function initCurrencyDropdown() {
      const select = document.getElementById('from-currency');
      
      // Sort currencies alphabetically by name
      const sortedCurrencies = [...currencies].sort((a, b) => a.name.localeCompare(b.name));
      
      // Clear any existing options
      select.innerHTML = '';
      
      // Add each currency as an option
      sortedCurrencies.forEach(currency => {
        const option = document.createElement('option');
        option.value = currency.code;
        option.textContent = `${currency.code} - ${currency.name}`;
        select.appendChild(option);
      });
      
      // Set default to EUR (Euro)
      select.value = 'EUR';
    }

    // Add event listeners
    document.getElementById('amount').addEventListener('input', convertCurrency);
    document.getElementById('from-currency').addEventListener('change', convertCurrency);
    document.getElementById('currency-search').addEventListener('input', (e) => {
      filterCurrencies(e.target.value);
    });
    
    // Add refresh button click handler
    document.getElementById('refresh-now').addEventListener('click', (e) => {
      e.preventDefault();
      refreshRates();
    });

    // Initial conversion and countdown start
    convertCurrency();
    startCountdown();
  </script>
</body>
</html>
